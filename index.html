<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Immunization Tracker</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💉</text></svg>">
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="screen active">
    <div class="login-container">
      <div class="login-header">
        <h1>🏥 Immunization Tracker</h1>
        <p>Ghana Health Service</p>
      </div>
      
      <form id="loginForm" class="login-form">
        <div class="form-group">
          <label for="facility">Health Facility</label>
          <select id="facility" required>
            <option value="">Select Facility</option>
            <option value="accra_central">Accra Central Hospital</option>
            <option value="kumasi_metro">Kumasi Metropolitan Hospital</option>
            <option value="tema_general">Tema General Hospital</option>
            <option value="takoradi_hospital">Takoradi Hospital</option>
            <option value="cape_coast">Cape Coast Metropolitan</option>
            <option value="tamale_teaching">Tamale Teaching Hospital</option>
            <option value="other">Other Facility</option>
          </select>
        </div>

        <div id="customFacilityGroup" class="form-group" style="display: none;">
          <label for="customFacility">Facility Name</label>
          <input type="text" id="customFacility" placeholder="Enter your facility name">
        </div>

        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" required placeholder="Enter your username">
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required placeholder="Enter your password">
        </div>

        <button type="submit" class="login-btn">🔐 Login</button>
        
        <div class="login-links">
          <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
          <a href="#" onclick="showRegister()">Register New Facility</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Forgot Password Screen -->
  <div id="forgotPasswordScreen" class="screen">
    <div class="login-container">
      <div class="login-header">
        <h2>🔑 Reset Password</h2>
        <p>Enter your details to reset password</p>
      </div>
      
      <form id="forgotPasswordForm" class="login-form">
        <div class="form-group">
          <label for="resetFacility">Health Facility</label>
          <select id="resetFacility" required>
            <option value="">Select Facility</option>
            <option value="accra_central">Accra Central Hospital</option>
            <option value="kumasi_metro">Kumasi Metropolitan Hospital</option>
            <option value="tema_general">Tema General Hospital</option>
            <option value="takoradi_hospital">Takoradi Hospital</option>
            <option value="cape_coast">Cape Coast Metropolitan</option>
            <option value="tamale_teaching">Tamale Teaching Hospital</option>
            <option value="other">Other Facility</option>
          </select>
        </div>

        <div class="form-group">
          <label for="resetUsername">Username</label>
          <input type="text" id="resetUsername" required placeholder="Enter your username">
        </div>

        <div class="form-group">
          <label for="resetEmail">Email Address</label>
          <input type="email" id="resetEmail" required placeholder="Enter your email">
        </div>

        <button type="submit" class="login-btn">📧 Send Reset Link</button>
        
        <div class="login-links">
          <a href="#" onclick="showLogin()">Back to Login</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Register Screen -->
  <div id="registerScreen" class="screen">
    <div class="login-container">
      <div class="login-header">
        <h2>🏥 Register Facility</h2>
        <p>Register your health facility</p>
      </div>
      
      <form id="registerForm" class="login-form">
        <div class="form-group">
          <label for="newFacilityName">Facility Name</label>
          <input type="text" id="newFacilityName" required placeholder="Enter facility name">
        </div>

        <div class="form-group">
          <label for="newFacilityType">Facility Type</label>
          <select id="newFacilityType" required>
            <option value="">Select Type</option>
            <option value="hospital">Hospital</option>
            <option value="clinic">Clinic</option>
            <option value="health_center">Health Center</option>
            <option value="chps_compound">CHPS Compound</option>
          </select>
        </div>

        <div class="form-group">
          <label for="newFacilityRegion">Region</label>
          <select id="newFacilityRegion" required>
            <option value="">Select Region</option>
            <option value="greater_accra">Greater Accra</option>
            <option value="ashanti">Ashanti</option>
            <option value="western">Western</option>
            <option value="central">Central</option>
            <option value="eastern">Eastern</option>
            <option value="volta">Volta</option>
            <option value="northern">Northern</option>
            <option value="upper_east">Upper East</option>
            <option value="upper_west">Upper West</option>
          </select>
        </div>

        <div class="form-group">
          <label for="adminName">Admin Name</label>
          <input type="text" id="adminName" required placeholder="Enter admin full name">
        </div>

        <div class="form-group">
          <label for="adminEmail">Admin Email</label>
          <input type="email" id="adminEmail" required placeholder="Enter admin email">
        </div>

        <div class="form-group">
          <label for="adminUsername">Username</label>
          <input type="text" id="adminUsername" required placeholder="Choose a username">
        </div>

        <div class="form-group">
          <label for="adminPassword">Password</label>
          <input type="password" id="adminPassword" required placeholder="Choose a password">
        </div>

        <button type="submit" class="login-btn">📝 Register Facility</button>
        
        <div class="login-links">
          <a href="#" onclick="showLogin()">Back to Login</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Main App Screen -->
  <div id="appScreen" class="screen">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <div class="facility-info">
          <h1>🏥 Immunization Tracker</h1>
          <span id="currentFacility" class="facility-name"></span>
        </div>
        <div class="user-actions">
          <span id="currentUser" class="user-name"></span>
          <button onclick="logout()" class="logout-btn">🚪 Logout</button>
        </div>
      </div>
    </header>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
      ⚠️ You are currently offline. The app will work with limited functionality.
    </div>

    <!-- Notification Area -->
    <div id="notificationArea"></div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading">
      <div class="spinner"></div>
      <p>Loading data...</p>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button onclick="scrollToSection('registration')">➕ Register Child</button>
      <button onclick="scrollToSection('childHealthRegister')">📋 View Register</button>
      <button onclick="scrollToSection('dashboard')">📊 View Dashboard</button>
      <button onclick="showTodayAppointments()">📅 Today's Appointments</button>
    </div>

    <!-- Facility Name Section -->
    <section id="facility">
      <h2>🏛️ Facility Information</h2>
      <form id="facilityForm">
        <label for="facilityName">Facility Name:</label>
        <input type="text" id="facilityName" required>
        <button type="submit">💾 Save Facility Name</button>
      </form>
    </section>

    <!-- Stats Section -->
    <section id="stats">
      <h2>📈 Statistics</h2>
      <div class="stats-container">
        <div class="stat-card">
          <h3>Total Children</h3>
          <div class="stat-value" id="totalChildren">0</div>
        </div>
        <div class="stat-card">
          <h3>Defaulters</h3>
          <div class="stat-value" id="totalDefaulters">0</div>
        </div>
        <div class="stat-card">
          <h3>Due Soon</h3>
          <div class="stat-value" id="totalDueSoon">0</div>
        </div>
        <div class="stat-card">
          <h3>Upcoming</h3>
          <div class="stat-value" id="totalUpcoming">0</div>
        </div>
      </div>
    </section>

    <!-- Section 1.0: Registration Form -->
    <section id="registration">
      <h2>👶 Register Child</h2>
      <form id="registrationForm">
        <label for="childName">Child's Name:</label>
        <input type="text" id="childName" required>

        <label for="dob">Date of Birth:</label>
        <input type="date" id="dob" required>

        <label for="sex">Sex:</label>
        <select id="sex" required>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>

        <label for="address">Address/Community:</label>
        <input type="text" id="address" required>

        <label for="contact">Contact (Optional):</label>
        <input type="text" id="contact">

        <button type="submit">✅ Register Child</button>
      </form>
    </section>

    <!-- Section 1.1: Child Health Register -->
    <section id="childHealthRegister">
      <h2>📋 Child Health Register</h2>
      <div class="search-container">
        <input type="text" id="search" placeholder="🔍 Search by name or registration number..." oninput="filterChildren()">
      </div>
      <table id="childTable">
        <thead>
          <tr>
            <th>Reg No.</th>
            <th>Name</th>
            <th>DOB</th>
            <th>Sex</th>
            <th>Address</th>
            <th>Contact</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows will be populated dynamically -->
        </tbody>
      </table>
      
      <div class="action-buttons">
        <button onclick="exportToCSV()">📤 Export to CSV</button>
        <button onclick="printRecords()">🖨️ Print Records</button>
        <button onclick="backupData()">💾 Backup Data</button>
        <input type="file" id="restoreFile" accept=".json" style="display: none;">
        <button onclick="document.getElementById('restoreFile').click()">📥 Restore Data</button>
        <button onclick="clearAllData()" class="danger">🗑️ Clear All Data</button>
        <button onclick="openHelpModal()">❓ Help/Instructions</button>
      </div>
    </section>

    <!-- Section 1.2: Dashboard -->
    <section id="dashboard">
      <h2>📊 Dashboard</h2>
      <div class="tab-container">
        <div class="tab-buttons">
          <button class="tab-button active" onclick="openTab('allRecords')">All Records</button>
          <button class="tab-button" onclick="openTab('defaulters')">Defaulters</button>
          <button class="tab-button" onclick="openTab('dueSoon')">Due Soon (7 days)</button>
          <button class="tab-button" onclick="openTab('upcoming')">Upcoming (30 days)</button>
        </div>
        
        <div id="allRecords" class="tab-content active">
          <table id="allRecordsTable">
            <thead>
              <tr>
                <th>Reg No.</th>
                <th>Name</th>
                <th>Completed Vaccines</th>
                <th>Booked Vaccines</th>
                <th>Next Visit Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated dynamically -->
            </tbody>
          </table>
        </div>
        
        <div id="defaulters" class="tab-content">
          <table id="defaultersTable">
            <thead>
              <tr>
                <th>Reg No.</th>
                <th>Name</th>
                <th>Missed Vaccine</th>
                <th>Missed Date</th>
                <th>Days Overdue</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated dynamically -->
            </tbody>
          </table>
        </div>
        
        <div id="dueSoon" class="tab-content">
          <table id="dueSoonTable">
            <thead>
              <tr>
                <th>Reg No.</th>
                <th>Name</th>
                <th>Due Vaccine</th>
                <th>Due Date</th>
                <th>Days Remaining</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated dynamically -->
            </tbody>
          </table>
        </div>
        
        <div id="upcoming" class="tab-content">
          <table id="upcomingTable">
            <thead>
              <tr>
                <th>Reg No.</th>
                <th>Name</th>
                <th>Scheduled Vaccine</th>
                <th>Scheduled Date</th>
                <th>Days Remaining</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- All Modals Here -->
    <!-- Immunization Modal -->
    <div id="immunizationModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>💉 Immunization Schedule</h2>
        <table id="immunizationTable">
          <thead>
            <tr>
              <th>Vaccine</th>
              <th>Date Given</th>
              <th>Batch Number</th>
              <th>Place Given</th>
              <th>Remarks</th>
              <th>Next Visit</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be populated dynamically -->
          </tbody>
        </table>
        <button onclick="promptToBookNextVisit()">💾 Save</button>
      </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeBookingModal()">&times;</span>
        <h2>📅 Book Next Visit</h2>
        <div class="booking-form">
          <h3>Select Vaccines for Next Visit:</h3>
          <div id="vaccineSelection">
            <!-- Vaccine checkboxes will be populated dynamically -->
          </div>
          <label for="nextVisitDate">Next Visit Date:</label>
          <input type="date" id="nextVisitDate" required>
          <button onclick="saveBooking()">✅ Confirm Booking</button>
        </div>
      </div>
    </div>

    <!-- View Records Modal -->
    <div id="viewRecordsModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeViewRecordsModal()">&times;</span>
        <h2>📋 View Immunization Records</h2>
        <div>
          <label for="selectChildren">Select Child(ren):</label>
          <select id="selectChildren" multiple>
            <!-- Options will be populated dynamically -->
          </select>
          <button onclick="viewSelectedChildrenRecords()">👁️ View Records</button>
        </div>
        <table id="viewRecordsTable">
          <thead>
            <tr>
              <th>Reg No.</th>
              <th>Name</th>
              <th>Vaccine</th>
              <th>Date Given</th>
              <th>Batch Number</th>
              <th>Place Given</th>
              <th>Remarks</th>
              <th>Next Visit</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be populated dynamically -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Edit Child Modal -->
    <div id="editChildModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeEditChildModal()">&times;</span>
        <h2>✏️ Edit Child Details</h2>
        <form id="editChildForm">
          <label for="editChildName">Child's Name:</label>
          <input type="text" id="editChildName" required>

          <label for="editDob">Date of Birth:</label>
          <input type="date" id="editDob" required>

          <label for="editSex">Sex:</label>
          <select id="editSex" required>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>

          <label for="editAddress">Address/Community:</label>
          <input type="text" id="editAddress" required>

          <label for="editContact">Contact (Optional):</label>
          <input type="text" id="editContact">

          <button type="button" onclick="saveEditedChild()">💾 Save Changes</button>
        </form>
      </div>
    </div>

    <!-- Today's Appointments Modal -->
    <div id="todayAppointmentsModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeTodayAppointmentsModal()">&times;</span>
        <h2>📅 Today's Appointments</h2>
        <table id="todayAppointmentsTable">
          <thead>
            <tr>
              <th>Reg No.</th>
              <th>Name</th>
              <th>Scheduled Vaccine</th>
              <th>Contact</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be populated dynamically -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeHelpModal()">&times;</span>
        <h2>❓ Help/Instructions</h2>
        <div style="max-height: 60vh; overflow-y: auto;">
          <h3>Getting Started</h3>
          <p>1. Register a child using the registration form.</p>
          <p>2. Update immunization records by clicking "Update" next to a child's name.</p>
          <p>3. Use the dashboard tabs to view defaulters, due soon, or all records.</p>
          
          <h3>Data Management</h3>
          <p>4. Export data to CSV or print records for offline use.</p>
          <p>5. Backup and restore data using the respective buttons.</p>
          <p>6. Clear all data if needed (use with caution).</p>
          
          <h3>Vaccination Workflow</h3>
          <p>7. When saving immunization records, you'll be prompted to book the next visit.</p>
          <p>8. Select vaccines for the next visit and set the date in the booking form.</p>
          <p>9. Use the "Today's Appointments" button to quickly view today's scheduled visits.</p>
          
          <h3>Tips</h3>
          <p>• Use the search function to quickly find children in the register.</p>
          <p>• The app works completely offline - no internet connection required.</p>
          <p>• Data is automatically saved as you work.</p>
          <p>• Use the quick action buttons at the top for easy navigation.</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      Developed By NASARE SURAJ | Immunization Tracker v3.0 | Ghana Health Service
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>